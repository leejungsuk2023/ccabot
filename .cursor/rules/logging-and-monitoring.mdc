# Logging and Monitoring Best Practices

## ğŸ“‹ Log Collection Strategy

### Automated Log Collection
Create [get_logs.bat](mdc:get_logs.bat) for automated log collection:
```batch
@echo off
REM Firebase Functions ë¡œê·¸ ì €ì¥ ìŠ¤í¬ë¦½íŠ¸

echo ğŸ“‹ Firebase Functions ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤...

REM í˜„ì¬ ì‹œê°„ì„ íŒŒì¼ëª…ì— í¬í•¨
set TIMESTAMP=%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%%time:~6,2%
set TIMESTAMP=%TIMESTAMP: =0%

REM ë¡œê·¸ íŒŒì¼ëª… ì„¤ì •
set LOG_FILE=firebase_logs_%TIMESTAMP%.txt

REM Firebase Functions ë¡œê·¸ ìˆ˜ì§‘
firebase functions:log --only channelTalkWebhook > %LOG_FILE% 2>&1

echo âœ… ë¡œê·¸ ìˆ˜ì§‘ ì™„ë£Œ!
echo ğŸ“ ì €ì¥ ìœ„ì¹˜: %LOG_FILE%
```

### Manual Log Collection
```bash
# Collect all function logs
firebase functions:log

# Collect specific function logs
firebase functions:log --only channelTalkWebhook
firebase functions:log --only updateAIBrainHttp

# Real-time log monitoring
firebase functions:log --follow
```

## ğŸ” Critical Log Analysis Patterns

### 1. FAQ Data Loading Verification
**Look for in logs**:
```javascript
// âœ… Correct data loading
ğŸ” [AI] Firestoreì—ì„œ ì¡°íšŒí•œ FAQ ë°ì´í„°: [{"id":"faq3","answer":"ê°•ë‚¨ì—­ 2ë²ˆ ì¶œêµ¬..."}]

// âŒ Old data still loading
ğŸ” [AI] Firestoreì—ì„œ ì¡°íšŒí•œ FAQ ë°ì´í„°: [{"id":"faq3","answer":"ê°•ë‚¨ì—­ 11ë²ˆ ì¶œêµ¬..."}]
```

### 2. AI Update Function Verification
**Look for in logs**:
```javascript
// âœ… Successful update
ğŸ” [UPDATE] knowledge_base/faqs ì—…ë°ì´íŠ¸ ì‹œì‘
ğŸ” [UPDATE] ì €ì¥í•  ë°ì´í„°: [{"id":"faq5","question":"ë³‘ì›ì€ ì–´ë””ì— ìˆì–´ìš”?"...}]
âœ… knowledge_base/faqs ì—…ë°ì´íŠ¸ ì™„ë£Œ

// âŒ Update failure
âŒ knowledge_base/faqs ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: Error message
```

### 3. Response Generation Monitoring
**Look for in logs**:
```javascript
// âœ… Immediate response (no delay)
ğŸš€ [AI] ì±„ë„í†¡ìœ¼ë¡œ ë‹µë³€ ì „ì†¡ ì‹œì‘...

// âŒ Delayed response (old code)
â° [AI] 25ì´ˆ ëŒ€ê¸° ì‹œì‘...
â° [AI] 25ì´ˆ ëŒ€ê¸° ì™„ë£Œ. ì±„ë„í†¡ìœ¼ë¡œ ë‹µë³€ ì „ì†¡ ì‹œì‘...
```

## ğŸ“Š Log Analysis Workflow

### Step 1: Collect Logs
```bash
# Automated collection
get_logs.bat

# Manual collection
firebase functions:log --only channelTalkWebhook > debug_logs.txt
```

### Step 2: Analyze Key Patterns
1. **Data Loading**: Check if FAQ data is current
2. **Update Success**: Verify AI update function execution
3. **Response Quality**: Monitor AI response content
4. **Performance**: Check for unnecessary delays
5. **API Calls**: Verify successful external API calls

### Step 3: Identify Issues
```javascript
// Common issues to look for:
- "No FAQs found" - Data not loaded
- "ê°•ë‚¨ì—­ 11ë²ˆ ì¶œêµ¬" - Old data still in use
- "ê°œì¸ì •ë³´ ë³´í˜¸" - AI instruction not followed
- "25ì´ˆ ëŒ€ê¸°" - Unnecessary delays
```

## ğŸš¨ Error Pattern Recognition

### Data Synchronization Errors
```javascript
// Problem: Old data persists
"faq3","answer":"ì €í¬ í´ë¦¬ë‹‰ì€ ê°•ë‚¨ì—­ 11ë²ˆ ì¶œêµ¬ì—ì„œ..."

// Solution: Re-run update function
curl "https://asia-northeast3-project-id.cloudfunctions.net/updateAIBrainHttp"
```

### AI Instruction Failures
```javascript
// Problem: AI ignores instructions
"ì£„ì†¡í•©ë‹ˆë‹¤. ë³‘ì›ì˜ ì •í™•í•œ ìœ„ì¹˜ëŠ” ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´..."

// Solution: Strengthen AI instructions
- "ê°œì¸ì •ë³´ ë³´í˜¸" ë˜ëŠ” "ì˜¨ë¼ì¸ìœ¼ë¡œ ê³µê°œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ê°™ì€ ë‹µë³€ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
```

### Performance Issues
```javascript
// Problem: Slow responses
â° [AI] 25ì´ˆ ëŒ€ê¸° ì‹œì‘...
â° [AI] 25ì´ˆ ëŒ€ê¸° ì™„ë£Œ...

// Solution: Remove delays
// await new Promise(resolve => setTimeout(resolve, 25000));
```

## ğŸ”§ Debugging Commands Reference

### Function Deployment
```bash
# Deploy specific function
firebase deploy --only functions:channelTalkWebhook
firebase deploy --only functions:updateAIBrainHttp

# Deploy all functions
firebase deploy --only functions
```

### Log Collection
```bash
# Collect logs with timestamp
get_logs.bat

# Collect specific function logs
firebase functions:log --only channelTalkWebhook
firebase functions:log --only updateAIBrainHttp

# Real-time monitoring
firebase functions:log --follow
```

### Function Testing
```bash
# Test AI update function
curl "https://asia-northeast3-project-id.cloudfunctions.net/updateAIBrainHttp"

# Test webhook function
curl -X POST "https://asia-northeast3-project-id.cloudfunctions.net/channelTalkWebhook"
```

## ğŸ“ˆ Monitoring Metrics

### Key Performance Indicators
1. **Response Time**: Should be immediate (no 25s delays)
2. **Data Accuracy**: FAQ data should match CSV content
3. **AI Compliance**: No "privacy policy" responses
4. **Update Success**: AI update function completes successfully
5. **API Success**: All external API calls succeed

### Success Indicators
```javascript
// âœ… Good response time
ğŸš€ [AI] ì±„ë„í†¡ìœ¼ë¡œ ë‹µë³€ ì „ì†¡ ì‹œì‘...

// âœ… Correct data usage
"ì €í¬ í´ë¦¬ë‹‰ì€ ê°•ë‚¨ì—­ 2ë²ˆ ì¶œêµ¬ì—ì„œ ë„ë³´ 5ë¶„ ê±°ë¦¬ì— ìˆìŠµë‹ˆë‹¤."

// âœ… Successful API call
âœ… [AI] ì±„ë„í†¡ìœ¼ë¡œ ë‹µë³€ ì „ì†¡ ì™„ë£Œ
```

### Failure Indicators
```javascript
// âŒ Slow response
â° [AI] 25ì´ˆ ëŒ€ê¸° ì‹œì‘...

// âŒ Wrong data
"ê°•ë‚¨ì—­ 11ë²ˆ ì¶œêµ¬"

// âŒ Unwanted response
"ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ì˜¨ë¼ì¸ìœ¼ë¡œ ê³µê°œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
```
description:
globs:
alwaysApply: false
---
